<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>应知应会题库（含解析）</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;max-width:1000px;margin:auto;padding:20px;}
.header{display:flex;justify-content:space-between;align-items:center;}
.question{font-size:18px;margin-bottom:8px;}
.option{margin:6px 0;display:block;}
.controls{margin-top:12px;}
.badge{display:inline-block;padding:6px 10px;background:#eee;border-radius:6px;margin-right:8px;}
.explanation{margin-top:12px;padding:12px;border-left:4px solid #007acc;background:#f6f9ff;}
.correct{color:green;font-weight:bold;}
.incorrect{color:red;font-weight:bold;}
.nextbtn{margin-top:10px;}
</style>
</head>
<body>
<div class="header"><h1>应知应会题库（含解析）</h1><div>题库题量：<span id="total"></span></div></div>
<p>说明：答题后页面会显示正确答案与解析（自动生成），建议对照手册校对。</p>
<div id="app">正在加载题库...</div>
<script>
let QUESTIONS=[];
let current=0,score=0;

function loadQuestions(){
  fetch('questions.json').then(r=>r.json()).then(data=>{QUESTIONS=data;document.getElementById('total').innerText=QUESTIONS.length;render();}).catch(e=>{document.getElementById('app').innerText='题库加载失败，请确认 questions.json 已上传。';});
}

function render(){
  if(current>=QUESTIONS.length){
    document.getElementById('app').innerHTML = '<h2>完成! 得分 '+score+'/'+QUESTIONS.length+'</h2><button onclick="restart()">重做</button>';
    return;
  }
  const q = QUESTIONS[current];
  let html = '<div class="question"><span class="badge">题 '+(current+1)+'/'+QUESTIONS.length+'</span> ' + escapeHtml(q.question) + '</div>';
  if(q.type==='single'){
    q.options.forEach(opt=> html += '<label class="option"><input name="opt" type="radio" value="'+escapeAttr(opt)+'"> '+escapeHtml(opt)+'</label>');
    html += '<div class="controls"><button onclick="submitSingle()">提交</button></div>';
  }else if(q.type==='multiple'){
    q.options.forEach(opt=> html += '<label class="option"><input type="checkbox" value="'+escapeAttr(opt)+'"> '+escapeHtml(opt)+'</label>');
    html += '<div class="controls"><button onclick="submitMulti()">提交</button></div>';
  }else if(q.type==='blank'){
    html += '<input id="blank" style="width:100%;padding:8px" placeholder="请输入答案"><div class="controls"><button onclick="submitBlank()">提交</button></div>';
  }
  html += '<div id="explainArea"></div>';
  document.getElementById('app').innerHTML = html;
}

function submitSingle(){
  const sel = document.querySelector('input[name=opt]:checked');
  if(!sel){alert('请选择答案');return;}
  const q = QUESTIONS[current];
  const user = sel.value;
  const correct = q.answer;
  const isCorrect = (user===correct);
  if(isCorrect) score++;
  showExplanation(isCorrect, correct, q.explanation);
}

function submitMulti(){
  const selected = Array.from(document.querySelectorAll('input[type=checkbox]:checked')).map(x=>x.value);
  const q = QUESTIONS[current];
  const ans = q.answer || [];
  let ok = false;
  try{ ok = JSON.stringify(selected.sort())===JSON.stringify(ans.sort()); }catch(e){ok=false;}
  if(ok) score++;
  showExplanation(ok, ans.join('；'), q.explanation);
}

function submitBlank(){
  const val = document.getElementById('blank').value.trim();
  const q = QUESTIONS[current];
  const ok = (val===q.answer);
  if(ok) score++;
  showExplanation(ok, q.answer, q.explanation);
}

function showExplanation(isCorrect, correctAnswer, explanation){
  const area = document.getElementById('explainArea');
  let status = isCorrect?'<div class="correct">回答正确 ✓</div>':'<div class="incorrect">回答错误 ✗</div>';
  let html = status + '<div>正确答案：<strong>'+escapeHtml(String(correctAnswer))+'</strong></div>';
  html += '<div class="explanation">'+escapeHtml(explanation)+'</div>';
  html += '<div class="nextbtn"><button onclick="nextQuestion()">下一题</button></div>';
  area.innerHTML = html;
  // disable inputs to prevent changing answer
  Array.from(document.querySelectorAll('input')).forEach(i=>i.disabled=true);
}

function nextQuestion(){ current++; render(); }

function restart(){ current=0; score=0; render(); }

function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function escapeAttr(s){ return String(s).replace(/"/g,'&quot;'); }

loadQuestions();
</script>
</body>
</html>
